import logging
import random
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup, InputMediaAnimation
from telegram.ext import ApplicationBuilder, CommandHandler, MessageHandler, CallbackQueryHandler, ContextTypes, filters

# –í–∫–ª—é—á–∞–µ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s', level=logging.INFO
)

TOKEN = "8285756176:AAEQNxrmwdRgz9X7YU0q0PVxgJNdnsdN4Cc"

# –•—Ä–∞–Ω–∏–ª–∏—â–µ —Å—Ç–∞–¥–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
user_stage = {}

wrong_answers = [
    "–ü—Ä–æ–≤–∞–ª –ë—Ä–æ—Å–∫–∞! –≠—Ç–æ –Ω–µ–≤–µ—Ä–Ω—ã–π –ø—É—Ç—å! –¢–≤–æ—è –∏–Ω—Ç—É–∏—Ü–∏—è —Ç–µ–±—è –ø–æ–¥–≤–æ–¥–∏—Ç.",
    "–ù–µ-–µ-–µ—Ç! –ò–ª–ª—é–∑–∏—è –¥–µ—Ä–∂–∏—Ç—Å—è! –ü–æ–≤—Ç–æ—Ä–∏ —Å–≤–æ–π –ø–æ–∏—Å–∫, –ì–µ—Ä–æ–π.",
    "–ù–µ —Ç–æ! –¢–≤–æ–π —Å–≤–∏—Ç–æ–∫ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –æ–∫–∞–∑–∞–ª—Å—è –ø—É—Å—Ç. –ü–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥—É—é —Ñ–æ—Ä–º—É–ª—É.",
    "–°–ª–∏—à–∫–æ–º –ø—Ä–æ—Å—Ç–æ. –≠—Ç–æ –ª–∏—à—å –æ–±–º–∞–Ω–∫–∞! –ú–∞–≥–∏—è —Å–ª–æ–∂–Ω–µ–µ, —á–µ–º –∫–∞–∂–µ—Ç—Å—è.",
    "–û—à–∏–±–∫–∞ –≤ —Ä–∞—Å—á–µ—Ç–∞—Ö! –û—Ç–≤–µ—Ç –Ω–µ —Å–æ–≤–ø–∞–ª —Å —Ñ–æ—Ä–º—É–ª–æ–π. –ü–æ–≤—Ç–æ—Ä–∏ –∞–Ω–∞–ª–∏–∑, –±—ã—Å—Ç—Ä–æ!"
]

# –°—Ç–∞—Ä—Ç –∫–æ–º–∞–Ω–¥—ã
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    user_stage[user_id] = 0

    keyboard = [[InlineKeyboardButton("–ù–∞—á–∞—Ç—å –∫–≤–µ—Å—Ç üó°Ô∏è", callback_data="start_quest")]]
    reply_markup = InlineKeyboardMarkup(keyboard)

    await update.message.reply_animation(
        animation=open("Gif-1.gif", "rb"),
        caption=(
            "<b>–û—Ö, –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é —Ç–µ–±—è, –ê–Ω–¥—Ä–µ–π, –ó–∞–≤–æ–µ–≤–∞—Ç–µ–ª—å –¢—Ä–µ—Ö —Å –ü–æ–ª–æ–≤–∏–Ω–æ–π –î–µ—Å—è—Ç–∏–ª–µ—Ç–∏–π!</b>\n\n"
            "–Ø, <b>–ú–∞–≥–∏—Å—Ç—Ä –§–ª–∞–≤–∏—É—Å –ê–±–µ—Å—Å–∏–Ω—Å–∫–∏–π</b>, –ê—Ä—Ö–∏–º–∞–≥ –®–∫–æ–ª—ã –¢—Ä–∞–Ω—Å–º—É—Ç–∞—Ü–∏–∏ –∏ <b>–ù–µ–±–µ—Å–Ω—ã–π –ü—Ä–µ–¥—Å–∫–∞–∑–∞—Ç–µ–ª—å –°–∫–∏–¥–æ–∫</b>, "
            "–ø—Ä–æ–∑—Ä–µ–≤–∞—é —Å–∫–≤–æ–∑—å —Ç—É–º–∞–Ω—ã –∏–∑–º–µ—Ä–µ–Ω–∏–π, —á—Ç–æ–±—ã —É–∑—Ä–µ—Ç—å —Ç–≤–æ–µ –≤–µ–ª–∏–∫–æ–µ... <b>–ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è</b>!\n\n"
            "–ñ–µ–ª–∞—é <b>–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –£—Å–ø–µ—Ö–æ–≤</b> –≤–æ –≤—Å–µ—Ö –¥–µ–ª–∞—Ö, –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ –∑–∞–ø–∞—Å–∞ <b>–•–∏—Ç –ü–æ–∏–Ω—Ç–æ–≤</b> –¥–ª—è –∑–¥–æ—Ä–æ–≤—å—è –∏ <b>–∑–æ–ª–æ—Ç–∞</b>, "
            "—á—Ç–æ–±—ã –≤—Å–µ–≥–¥–∞ —Ö–≤–∞—Ç–∞–ª–æ –Ω–∞ –ª—É—á—à–∏–µ –∑–µ–ª—å—è –∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã. –ü—É—Å—Ç—å –∫–∞–∂–¥—ã–π —Ç–≤–æ–π –¥–µ–Ω—å –¥–∞—Ä–∏—Ç <b>–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –ª—É—Ç</b>! –° 35-–º —É—Ä–æ–≤–Ω–µ–º!\n\n"
            "–¢–≤–æ—è –¥–æ–±–ª–µ—Å—Ç–Ω–∞—è –¥—É—à–∞ –∏ –∑–∞—Å–ª—É–∂–µ–Ω–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç –ø—Ä–∏—Ç—è–≥–∏–≤–∞—é—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –¥—Ä–∞–∫–æ–Ω–æ–≤, –Ω–æ –∏ —Å–æ–∫—Ä–æ–≤–∏—â–∞! "
            "–Ø, –ú–∞–≥–∏—Å—Ç—Ä –§–ª–∞–≤–∏—É—Å, —Å–æ–æ–±—â–∞—é: —Ç–≤–æ–∏ –ø–æ–¥–∞—Ä–∫–∏ –Ω–µ –¥–æ—Å—Ç–∞–Ω—É—Ç—Å—è —Ç–µ–±–µ –ª–µ–≥–∫–æ. "
            "–û–Ω–∏ –∑–∞–ø–µ—á–∞—Ç–∞–Ω—ã <b>–ú–æ—â–Ω—ã–º –ó–∞–∫–ª–∏–Ω–∞–Ω–∏–µ–º –í—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –°–º–µ—â–µ–Ω–∏—è</b>, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–Ω–æ —Å–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ –≤—ã–ø–æ–ª–Ω–∏–≤ <b>–ö–≤–µ—Å—Ç –î–Ω—è –†–æ–∂–¥–µ–Ω–∏—è</b>!\n\n"
            "–°–æ–±–µ—Ä–∏ —Å–≤–æ–π –æ—Ç—Ä—è–¥, –∑–∞—Ç–æ—á–∏ <b>–ú–µ—á –û—Å—Ç—Ä—ã—Ö –®—É—Ç–æ–∫</b> –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–π—Å—è! "
            "–ò –ø–æ–º–Ω–∏: –∫–∞–∂–¥—ã–π –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–π —ç—Ç–∞–ø –ö–≤–µ—Å—Ç–∞ –¥–∞–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ <b>–û–ø—ã—Ç</b>, –Ω–æ –∏ <b>–ß–∞—Å—Ç—å –ù–∞–≥—Ä–∞–¥—ã</b>!\n"
            "–î–∞ –ø—Ä–µ–±—É–¥–µ—Ç —Å —Ç–æ–±–æ–π <b>–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –£—Å–ø–µ—Ö</b> –≤ –ø–æ–∏—Å–∫–∞—Ö! üèπ"
        ),
        parse_mode="HTML",
        reply_markup=reply_markup
    )

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –∫–Ω–æ–ø–æ–∫
async def button_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    user_id = query.from_user.id
    await query.answer()

    stage = user_stage.get(user_id, 0)

    if query.data == "start_quest" and stage == 0:
        user_stage[user_id] = 1
        # –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ó–∞–¥–∞–Ω–∏—è 1
        await query.message.reply_text(
            "<b>–ê–Ω–¥—Ä–µ–π, —Ç—ã –ø—Ä–∏–Ω—è–ª –≤—ã–∑–æ–≤! –ú—É–¥—Ä–æ!</b> –ù–æ –¥–ª—è –Ω–∞—á–∞–ª–∞, —Ç—ã –¥–æ–ª–∂–µ–Ω –¥–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –≥–ª–∞–∑ —Ç–≤–æ–π –æ—Å—Ç–µ—Ä, –∞ –ø–∞–º—è—Ç—å –æ –¢–≤–æ–µ–º –õ–∏—á–Ω–æ–º –ü–æ–¥–∑–µ–º–µ–ª—å–µ ‚Äî –±–µ–∑—É–ø—Ä–µ—á–Ω–∞.\n\n"
            "<b>–ó–ê–î–ê–ù–ò–ï 1: –ò–°–ü–´–¢–ê–ù–ò–ï –ù–ê–ë–õ–Æ–î–ê–¢–ï–õ–¨–ù–û–°–¢–ò</b>\n"
            "–Ø –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Å–≤–æ–µ –º–æ–≥—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ <b>–ó–∞–∫–ª–∏–Ω–∞–Ω–∏–µ –ò–ª–ª—é–∑–∏–∏ 4-–≥–æ –ö—Ä—É–≥–∞</b> –∏ —Å–ª–µ–≥–∫–∞ –∏–∑–º–µ–Ω–∏–ª –æ–¥–Ω—É —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω —É–≥–æ–ª —Ç–≤–æ–µ–≥–æ –º–∏—Ä–Ω–æ–≥–æ —É–±–µ–∂–∏—â–∞. "
            "–≠—Ç–æ —É–≥–æ–ª–æ–∫, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã –≤–∏–¥–∏—à—å –ø–æ—Å—Ç–æ—è–Ω–Ω–æ, –ø–æ—á—Ç–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏—è.\n\n"
            "–¢–≤–æ—è –∑–∞–¥–∞—á–∞, –ì–µ—Ä–æ–π: –í–∑–≥–ª—è–Ω–∏ –Ω–∞ –ø—Ä–∏—Å–ª–∞–Ω–Ω—ã–π –æ–±—Ä–∞–∑. –ß—Ç–æ –Ω–µ —Ç–∞–∫? –ö–∞–∫–æ–π <b>–í–∞–∂–Ω—ã–π –ê—Ä—Ç–µ—Ñ–∞–∫—Ç</b>, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ —ç—Ç–æ–º –º–µ—Å—Ç–µ, –±—ã–ª –≤—Ä–µ–º–µ–Ω–Ω–æ –∏–∑–≥–Ω–∞–Ω –∏–∑ —ç—Ç–æ–≥–æ –ò–∑–º–µ—Ä–µ–Ω–∏—è –º–æ–µ–π –º–∞–≥–∏–µ–π?\n\n"
            "–£–¥–∞—á–∏, <b>–ò—Å–∫–∞—Ç–µ–ª—å –°–æ–∫—Ä–æ–≤–∏—â</b>! –î–∞ –±—É–¥–µ—Ç —Ç–≤–æ—è –ø—Ä–æ–Ω–∏—Ü–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–∞–∫ –∂–µ –æ—Å—Ç—Ä–∞, –∫–∞–∫ –∫–æ–≥—Ç–∏! üêæ",
            parse_mode="HTML"
        )
        with open("Photo-1.jpg", "rb") as photo:
            await query.message.reply_photo(photo=photo, has_spoiler=True)

# –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
async def text_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    stage = user_stage.get(user_id, 0)
    text = update.message.text.strip()

    # –ó–∞–¥–∞–Ω–∏–µ 1
    if stage == 1:
        if text.lower() == "–∫—Ä–∏–º–∏–Ω–∞–ª—å–Ω–æ–µ —á—Ç–∏–≤–æ":
            user_stage[user_id] = 2
            await update.message.reply_text(
                "<b>–ë–†–ê–í–û, –ê–ù–î–†–ï–ô!</b> –¢–≤–æ–π <b>–ë—Ä–æ—Å–æ–∫ –Ω–∞ –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç</b> —É—Å–ø–µ—à–µ–Ω, <b>–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –£—Å–ø–µ—Ö</b>! –¢—ã –ø—Ä–æ—Ä–≤–∞–ª—Å—è —Å–∫–≤–æ–∑—å –º–æ–∏ —á–∞—Ä—ã! –ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ!\n"
                "–ù–æ –Ω–µ —Ä–∞—Å—Å–ª–∞–±–ª—è–π—Å—è! –¢–≤–æ–µ —Å–ª–µ–¥—É—é—â–µ–µ –∏—Å–ø—ã—Ç–∞–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç <b>–ö–æ—à–∞—á—å–µ–π –ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã</b>!\n\n"
                "<b>–ó–ê–î–ê–ù–ò–ï 2: –¢–û–ß–ö–ê –ó–†–ï–ù–ò–Ø –ê–†–¢–ï–§–ê–ö–¢–ê</b>\n"
                "–Ø –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª <b>–ó–∞–∫–ª–∏–Ω–∞–Ω–∏–µ –°–º–µ—â–µ–Ω–∏—è –î—É—à–∏</b> –∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–º–µ—Å—Ç–∏–ª –æ–¥–∏–Ω –∏–∑ —Ç–≤–æ–∏—Ö –ø–æ–¥–∞—Ä–∫–æ–≤ –≤... –Ω–µ–æ–±—ã—á–Ω–æ–µ –º–µ—Å—Ç–æ.\n"
                "–¢–≤–æ—è –∑–∞–¥–∞—á–∞: –ù–∞–π—Ç–∏ –º–µ—Å—Ç–æ –≤ —Ç–≤–æ–µ–º <b>–õ–æ–≥–æ–≤–µ</b>, –≥–¥–µ —Å–µ–π—á–∞—Å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —ç—Ç–æ—Ç —Ç–∞–π–Ω—ã–π –ê—Ä—Ç–µ—Ñ–∞–∫—Ç!\n"
                "–û—Ä–∏–µ–Ω—Ç–∏—Ä—É–π—Å—è –ø–æ –ø–æ—Ç–æ–ª–∫—É, –ø–æ–ª—É, –º–µ–±–µ–ª–∏! –î—É–º–∞–π, –∫–∞–∫ <b>–°–ø—è—â–∏–π –ö–æ—Ç</b>, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–±–ª—é–¥–∞–µ—Ç –∑–∞ –º–∏—Ä–æ–º –∏–∑ —Å–≤–æ–µ–≥–æ —É–∫—Ä–æ–º–Ω–æ–≥–æ –º–µ—Å—Ç–∞! üê±",
                parse_mode="HTML"
            )
            with open("Photo-2.jpg", "rb") as photo:
                await update.message.reply_photo(photo=photo, has_spoiler=True)
        else:
            await update.message.reply_text(random.choice(wrong_answers))

    # –ó–∞–¥–∞–Ω–∏–µ 2
    elif stage == 2:
        if text.lower() == "–º–∞—Ä—Å–µ–ª—å":
            user_stage[user_id] = 3
            await update.message.reply_text(
                "<b>–ë–õ–ï–°–¢–Ø–©–ï, –ê–ù–î–†–ï–ô!</b> –¢—ã –æ–±–ª–∞–¥–∞–µ—à—å <b>–ü–æ–≤—ã—à–µ–Ω–Ω—ã–º –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º</b> –∑–∞–º–ª—É–∂–µ–Ω–Ω–æ! "
                "–¢—ã –≤–µ—Ä–Ω–æ –æ—Ç–≥–∞–¥–∞–ª —à–∞—Ä–∞–¥—É! –ó–∞–¥–∞–Ω–∏–µ 2 –≤—ã–ø–æ–ª–Ω–µ–Ω–æ!\n\n"
                "<b>–ó–ê–î–ê–ù–ò–ï 3: –¢–ê–ö–¢–ò–õ–¨–ù–û–ï –ò–°–ü–´–¢–ê–ù–ò–ï</b>\n"
                "–Ø –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª <b>–ó–∞–∫–ª–∏–Ω–∞–Ω–∏–µ –¢—Ä–∞–Ω—Å–º—É—Ç–∞—Ü–∏–∏ –ü–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏</b> –∏ —Å–ª–∏–ª —Ç–≤–æ–π –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–ø—Ä—è—Ç–∞–Ω–Ω—ã–π –¥–∞—Ä —Å –æ–∫—Ä—É–∂–∞—é—â–µ–π —Å—Ä–µ–¥–æ–π!\n"
                "–¢–≤–æ—è –∑–∞–¥–∞—á–∞: –ù–∞–π—Ç–∏ —ç—Ç–æ—Ç —É–∑–æ—Ä –≤ —Ç–≤–æ–µ–π –∫–≤–∞—Ä—Ç–∏—Ä–µ! –ü–æ—Å–ª–µ–¥–Ω–∏–π –ü–æ–¥–∞—Ä–æ–∫ —Å–ø—Ä—è—Ç–∞–Ω –∏–º–µ–Ω–Ω–æ <b>–í –≠–¢–û–ú –ú–ï–°–¢–ï</b>, —Å–ª–∏–≤—à–∏—Å—å —Å –Ω–∏–º!\n"
                "–°–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä—É–π —Å–≤–æ—é <b>–ú–∞–≥–∏—é –û—Å—è–∑–∞–Ω–∏—è</b>! –î—É–º–∞–π, –∫–∞–∫ –ö–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–±–∏—Ä–∞–µ—Ç —Å–∞–º–æ–µ –º—è–≥–∫–æ–µ –∏ –Ω–µ–∑–∞–º–µ—Ç–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è —Å–Ω–∞! üêæ",
                parse_mode="HTML"
            )
            with open("Photo-3.jpg", "rb") as photo:
                await update.message.reply_photo(photo=photo, has_spoiler=True)
        else:
            await update.message.reply_text(random.choice(wrong_answers))

    # –ó–∞–¥–∞–Ω–∏–µ 3
    elif stage == 3:
        if text == "7":
            user_stage[user_id] = 4
            await update.message.reply_text(
                "<b>–í–û–°–•–ò–¢–ò–¢–ï–õ–¨–ù–û, –ê–ù–î–†–ï–ô!</b> –¢–≤–æ—è <b>–õ–æ–≥–∏–∫–∞</b> –Ω–∞ —É—Ä–æ–≤–Ω–µ –≠–ª—å—Ñ–∞-–Ø—Å–Ω–æ–≤–∏–¥—Ü–∞! –¢—ã –ø–æ–±–µ–¥–∏–ª! –ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ!\n"
                "–ù–æ —Ç–µ–ø–µ—Ä—å —Ç—ã —Å—Ç–æ–∏—à—å –ø–µ—Ä–µ–¥ <b>–°—É–Ω–¥—É–∫–æ–º –°–æ–∫—Ä–æ–≤–∏—â</b>! –û–Ω –∑–∞–ø–µ—Ä—Ç –¥—Ä–µ–≤–Ω–∏–º –ó–∞–º–∫–æ–º –ß–∏—Å–µ–ª, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–∫—Ä–æ–µ—Ç —Ç–æ–ª—å–∫–æ –≤–µ—Ä–Ω—ã–π –∫–æ–¥!\n\n"
                "<b>–§–ò–ù–ê–õ–¨–ù–û–ï –ò–°–ü–´–¢–ê–ù–ò–ï: –õ–ê–ë–ò–†–ò–ù–¢ –•–†–ê–ù–ò–¢–ï–õ–Ø –ö–û–î–ê</b>\n"
                "–ü–µ—Ä–µ–¥ —Ç–æ–±–æ–π –ª–µ–∂–∏—Ç <b>–õ–∞–±–∏—Ä–∏–Ω—Ç</b>, –Ω–∞—á–µ—Ä—Ç–∞–Ω–Ω—ã–π –Ω–∞ –ª–∏—Å—Ç–µ (–∏–ª–∏ —ç–∫—Ä–∞–Ω–µ). "
                "–°–æ–±–µ—Ä–∏ —Ü–∏—Ñ—Ä—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å <b>–ö–æ–¥ –∏–∑ 3 –ó–Ω–∞–∫–æ–≤</b>! "
                "–°–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä—É–π —Å–≤–æ—é <b>–õ–æ–≤–∫–æ—Å—Ç—å –∏ –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç</b>! –¢–æ–ª—å–∫–æ –≤–µ—Ä–Ω—ã–π –∫–æ–¥ –æ—Ç–∫—Ä–æ–µ—Ç –°—É–Ω–¥—É–∫! üóùÔ∏è",
                parse_mode="HTML"
            )
            with open("Photo-4.jpg", "rb") as photo:
                await update.message.reply_photo(photo=photo, has_spoiler=True)
        else:
            await update.message.reply_text(random.choice(wrong_answers))

    # –§–∏–Ω–∞–ª—å–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ
    elif stage == 4:
        if text == "99":
            user_stage[user_id] = 5
            await update.message.reply_text(
                "<b>–í–û–°–•–ò–¢–ò–¢–ï–õ–¨–ù–û, –ê–ù–î–†–ï–ô!</b> –¢–≤–æ—è <b>–õ–æ–≤–∫–æ—Å—Ç—å –∏ –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç</b> –ø—Ä–µ–æ–¥–æ–ª–µ–ª–∏ —ç—Ç–æ –∏—Å–ø—ã—Ç–∞–Ω–∏–µ! "
                "–°—á–µ—Ç—á–∏–∫ –ö–≤–µ—Å—Ç–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç: <b>–ü–û–ë–ï–î–ê!</b>\n\n"
                "<b>–§–ò–ù–ê–õ–¨–ù–´–ô –ê–ö–¢: –ö–û–û–†–î–ò–ù–ê–¢–´ –ì–õ–ê–í–ù–û–ì–û –ê–†–¢–ï–§–ê–ö–¢–ê</b>\n"
                "–¢–≤–æ—è —Ü–µ–ª—å ‚Äî <b>–ì–ª–∞–≤–Ω—ã–π –ê—Ä—Ç–µ—Ñ–∞–∫—Ç</b> ‚Äî –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –†–Ø–î–û–ú! –¢–∞–∫ –±–ª–∏–∑–∫–æ, –∫–∞–∫ –Ω–∏–∫–æ–≥–¥–∞!\n"
                "–Ø –ø—Ä–∏—Å—ã–ª–∞—é —Ç–µ–±–µ <b>–¢—Ä–∏–æ –ü—Ä–µ–¥–≤–µ—Å—Ç–Ω–∏–∫–æ–≤</b>! –¢–≤–æ—è –∑–∞–¥–∞—á–∞: –Ω–∞–π—Ç–∏ –º–µ—Å—Ç–æ, –≥–¥–µ –í–°–ï –¢–†–ò –ü–†–ï–î–ú–ï–¢–ê —Å—Ö–æ–¥—è—Ç—Å—è –Ω–∞ –ö–∞—Ä—Ç–µ –¢–≤–æ–µ–≥–æ –î–æ–º–∞!\n"
                "–ò–º–µ–Ω–Ω–æ —Ç–∞–º, –≤ –¶–µ–Ω—Ç—Ä–µ –ü—Ä–∏—Ç—è–∂–µ–Ω–∏—è —ç—Ç–∏—Ö –ê—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤, –ª–µ–∂–∏—Ç <b>–¢–í–û–ô –§–ò–ù–ê–õ–¨–ù–´–ô, –°–ò–Ø–Æ–©–ò–ô, –õ–ï–ì–ï–ù–î–ê–†–ù–´–ô –ü–û–î–ê–†–û–ö</b>! üèÜ\n"
                "–î–∞ –ø—Ä–µ–±—É–¥–µ—Ç —Å —Ç–æ–±–æ–π <b>–ò–Ω—Å—Ç–∏–Ω–∫—Ç –∏ –ë–æ–Ω—É—Å –∫ –°–∫–æ—Ä–æ—Å—Ç–∏ –î–≤–∏–∂–µ–Ω–∏—è</b>! –ú–ò–°–°–ò–Ø –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è, –∫–∞–∫ —Ç–æ–ª—å–∫–æ —Ç—ã –∑–∞–±–µ—Ä–µ—à—å —Å–≤–æ—é <b>–ù–∞–≥—Ä–∞–¥—É 35-–≥–æ –£—Ä–æ–≤–Ω—è</b>!",
                parse_mode="HTML"
            )
            with open("Photo-4.jpg", "rb") as photo:
                await update.message.reply_photo(photo=photo, has_spoiler=True)
        else:
            await update.message.reply_text(random.choice(wrong_answers))

    # –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫–≤–µ—Å—Ç–∞ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    elif stage == 5:
        keyboard = [[InlineKeyboardButton("–î–∞, —è –≤—ã–ø–æ–ª–Ω–∏–ª –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è ‚úÖ", callback_data="finished")]]
        reply_markup = InlineKeyboardMarkup(keyboard)
        await update.message.reply_text(
            "–ß—Ç–æ —Ç—ã —Ç—É—Ç –∏—â–µ—à—å, –ê–Ω–¥—Ä–µ–π? –¢–≤–æ–π <b>–ñ—É—Ä–Ω–∞–ª –ö–≤–µ—Å—Ç–æ–≤</b> –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—É—Å—Ç, –∞ <b>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</b> ‚Äî –ø–æ–ª–æ–Ω! "
            "–¢—ã –∑–∞–≤–µ—Ä—à–∏–ª –≤—Å–µ –ò—Å–ø—ã—Ç–∞–Ω–∏—è? –ù–∞—à–µ–ª <b>–§–∏–Ω–∞–ª—å–Ω—ã–π –ê—Ä—Ç–µ—Ñ–∞–∫—Ç</b>?\n–í—Ä–µ–º—è –Ω–µ –∂–¥–µ—Ç! –û—Ç–≤–µ—á–∞–π, –≤–æ–∏–Ω! ‚öîÔ∏è",
            parse_mode="HTML",
            reply_markup=reply_markup
        )
    else:
        await update.message.reply_text("–ò—Å–ø–æ–ª—å–∑—É–π /start, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∫–≤–µ—Å—Ç.")

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ "–î–∞, —è –≤—ã–ø–æ–ª–Ω–∏–ª –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è"
async def finished_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    await query.message.reply_animation(
        animation=open("Gif-2.gif", "rb"),
        caption=(
            "–°–õ–£–®–ê–ô–¢–ï –ò –í–ù–ò–ú–ê–ô–¢–ï, –ñ–ò–¢–ï–õ–ò –í–°–ï–• –ò–ó–ú–ï–†–ï–ù–ò–ô! üåå\n"
            "<b>–ê–ù–î–†–ï–ô, –¢–ò–¢–ê–ù 35-–ì–û –£–†–û–í–ù–Ø</b>, –û–§–ò–¶–ò–ê–õ–¨–ù–û –ó–ê–í–ï–†–®–ò–õ –≠–ü–ò–ß–ï–°–ö–£–Æ –ö–ê–ú–ü–ê–ù–ò–Æ –î–ù–Ø –†–û–ñ–î–ï–ù–ò–Ø!\n"
            "–ï–≥–æ <b>–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç</b> –ø—Ä–µ–æ–¥–æ–ª–µ–ª –∏–ª–ª—é–∑–∏–∏, <b>–õ–æ–≤–∫–æ—Å—Ç—å</b> –æ–±–æ—à–ª–∞ –ª–æ–≤—É—à–∫–∏, –∞ <b>–ú—É–¥—Ä–æ—Å—Ç—å</b> –ø—Ä–∏–≤–µ–ª–∞ –∫ –§–∏–Ω–∞–ª—å–Ω–æ–º—É –õ—É—Ç—É! "
            "–¢—ã –¥–æ–∫–∞–∑–∞–ª, —á—Ç–æ —è–≤–ª—è–µ—à—å—Å—è –ò—Å—Ç–∏–Ω–Ω—ã–º –í–ª–∞—Å—Ç–µ–ª–∏–Ω–æ–º —Å–≤–æ–µ–≥–æ <b>–õ–æ–≥–æ–≤–∞</b>! –¢–≤–æ–π –°—á–µ—Ç –û–ø—ã—Ç–∞ —Å–µ–≥–æ–¥–Ω—è –¥–æ—Å—Ç–∏–≥ –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã—Ö –≤—ã—Å–æ—Ç!\n\n"
            "–ü—É—Å—Ç—å —Ç–≤–æ–π <b>–ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä –•–∞—Ä–∏–∑–º—ã</b> –æ—á–∞—Ä–æ–≤—ã–≤–∞–µ—Ç –≤—Å–µ—Ö —Å–æ—é–∑–Ω–∏–∫–æ–≤, —Ç–≤–æ–π <b>–°–ø–∞—Å–±—Ä–æ—Å–æ–∫ –æ—Ç –£—Å—Ç–∞–ª–æ—Å—Ç–∏</b> –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç —É—Å–ø–µ—à–µ–Ω, "
            "–∞ —Ç–≤–æ—è <b>–ö—É—á–∞ –ó–æ–ª–æ—Ç–∞</b> –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è!\n\n"
            "–ú–´ –°–ê–õ–Æ–¢–£–ï–ú –¢–ï–ë–ï, –ê–ù–î–†–ï–ô! –û—Ç–ø—Ä–∞–∑–¥–Ω—É–π —Å–≤–æ—é –ü–æ–±–µ–¥—É —Å —á–µ—Å—Ç—å—é –∏ –∏–∑–æ–±–∏–ª–∏–µ–º! üéâ\n"
            "<b>–° –î–ù–ï–ú –†–û–ñ–î–ï–ù–ò–Ø!</b>"
        ),
        parse_mode="HTML"
    )

# –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
if __name__ == "__main__":
    app = ApplicationBuilder().token(TOKEN).build()

    app.add_handler(CommandHandler("start", start))
    app.add_handler(CallbackQueryHandler(button_handler, pattern="^start_quest$"))
    app.add_handler(CallbackQueryHandler(finished_handler, pattern="^finished$"))
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, text_handler))

    print("üî• –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω! –ù–∞–∂–º–∏ Ctrl+C, —á—Ç–æ–±—ã –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å.")
    app.run_polling()
